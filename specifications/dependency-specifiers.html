
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Dependency specifiers &#8212; Python Packaging User Guide</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/pypa.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/tabs.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/translations.js"></script>
    
    <script src="../_static/sidebar.js"></script>
    
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Declaring build system dependencies" href="declaring-build-dependencies.html" />
    <link rel="prev" title="版本说明符" href="version-specifiers.html" /><link rel="shortcut icon" type="image/png" href="../_static/py.svg" />
            <script type="text/javascript" src="../_static/copybutton.js"></script>
            <script type="text/javascript" src="../_static/menu.js"></script> 
  </head>
<body>
<div class="mobile-nav">
    <input type="checkbox" id="menuToggler" class="toggler__input" aria-controls="navigation"
           aria-pressed="false" aria-expanded="false" role="button" aria-label="Menu" />
    <label for="menuToggler" class="toggler__label">
        <span></span>
    </label>
    <nav class="nav-content" role="navigation">
         <a href="https://pypa.io" class="nav-logo">
             <img src="../_static/py.svg" alt="Logo"/>
         </a>
        <div class="version_switcher_placeholder"></div>
        <form role="search" class="search" action="../search.html" method="get">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="search-icon">
                <path fill-rule="nonzero"
                        d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 001.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 00-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 005.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" fill="#444"></path>
            </svg>
            <input type="text" name="q" aria-label="快速搜索"/>
            <input type="submit" value="转向"/>
        </form>
    </nav>
    <div class="menu-wrapper">
        <nav class="menu" role="navigation" aria-label="main navigation">
            <div class="language_switcher_placeholder"></div>
<h3><a href="../index.html">目录</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Python 包装的概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../flow.html">The Packaging Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/index.html">指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../discussions/index.html">讨论</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">PyPA 规范</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#package-distribution-metadata">包分发元数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#package-distribution-file-formats">包分发文件格式</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#package-index-interfaces">包索引接口</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../key_projects.html">项目摘要</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">术语表</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">如何获得支持</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute.html">为本指南做出贡献</a></li>
<li class="toctree-l1"><a class="reference internal" href="../news.html">新闻</a></li>
</ul>

  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="version-specifiers.html"
                          title="上一章">版本说明符</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="declaring-build-dependencies.html"
                          title="下一章">Declaring build system dependencies</a></p>
  </div>
        </nav>
    </div>
</div>
  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="declaring-build-dependencies.html" title="Declaring build system dependencies"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="version-specifiers.html" title="版本说明符"
             accesskey="P">上一页</a> |</li>
          <li><img src="../_static/py.svg" alt="python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://pypa.io">PyPA</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
              <a href="../index.html">Python Packaging User Guide</a> &#187;
              
          </li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">PyPA 规范</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Dependency specifiers</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="快速搜索" aria-label="快速搜索" type="text" name="q" />
          <input type="submit" value="转向" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
                     |
                </li>
            
      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="dependency-specifiers">
<span id="id1"></span><h1>Dependency specifiers<a class="headerlink" href="#dependency-specifiers" title="永久链接至标题">¶</a></h1>
<p>This document describes the dependency specifiers format as originally specified
in <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0508/"><strong>PEP 508</strong></a>.</p>
<p>The job of a dependency is to enable tools like pip <a class="footnote-reference brackets" href="#pip" id="id2">1</a> to find the right
package to install. Sometimes this is very loose - just specifying a name, and
sometimes very specific - referring to a specific file to install. Sometimes
dependencies are only relevant in one platform, or only some versions are
acceptable, so the language permits describing all these cases.</p>
<p>The language defined is a compact line based format which is already in
widespread use in pip requirements files, though we do not specify the command
line option handling that those files permit. There is one caveat - the
URL reference form, specified in <span class="target" id="index-1"></span><a class="pep reference external" href="https://peps.python.org/pep-0440/"><strong>PEP 440</strong></a> is not actually
implemented in pip, but since <span class="target" id="index-2"></span><a class="pep reference external" href="https://peps.python.org/pep-0440/"><strong>PEP 440</strong></a> is accepted, we use that format rather
than pip’s current native format.</p>
<section id="specification">
<h2>Specification<a class="headerlink" href="#specification" title="永久链接至标题">¶</a></h2>
<section id="examples">
<h3>例子<a class="headerlink" href="#examples" title="永久链接至标题">¶</a></h3>
<p>All features of the language shown with a name based lookup:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">requests</span> <span class="p">[</span><span class="n">security</span><span class="p">,</span><span class="n">tests</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">2.8.1</span><span class="p">,</span> <span class="o">==</span> <span class="mf">2.8</span><span class="o">.*</span> <span class="p">;</span> <span class="n">python_version</span> <span class="o">&lt;</span> <span class="s2">&quot;2.7&quot;</span>
</pre></div>
</div>
<p>A minimal URL based lookup:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="o">@</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">pypa</span><span class="o">/</span><span class="n">pip</span><span class="o">/</span><span class="n">archive</span><span class="o">/</span><span class="mf">1.3.1</span><span class="o">.</span><span class="n">zip</span><span class="c1">#sha1=da9234ee9982d4bbb3c72346a6de940a148ea686</span>
</pre></div>
</div>
</section>
<section id="concepts">
<h3>Concepts<a class="headerlink" href="#concepts" title="永久链接至标题">¶</a></h3>
<p>A dependency specification always specifies a distribution name. It may
include extras, which expand the dependencies of the named distribution to
enable optional features. The version installed can be controlled using
version limits, or giving the URL to a specific artifact to install. Finally
the dependency can be made conditional using environment markers.</p>
</section>
<section id="grammar">
<h3>Grammar<a class="headerlink" href="#grammar" title="永久链接至标题">¶</a></h3>
<p>We first cover the grammar briefly and then drill into the semantics of each
section later.</p>
<p>A distribution specification is written in ASCII text. We use a parsley
<a class="footnote-reference brackets" href="#parsley" id="id3">2</a> grammar to provide a precise grammar. It is expected that the
specification will be embedded into a larger system which offers framing such
as comments, multiple line support via continuations, or other such features.</p>
<p>The full grammar including annotations to build a useful parse tree is
included at the end of this document.</p>
<p>Versions may be specified according to the <span class="target" id="index-3"></span><a class="pep reference external" href="https://peps.python.org/pep-0440/"><strong>PEP 440</strong></a> rules. (Note:
URI is defined in <span class="target" id="index-4"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3986.html"><strong>std-66</strong></a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">version_cmp</span>   <span class="o">=</span> <span class="n">wsp</span><span class="o">*</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">|</span> <span class="s1">&#39;&lt;=&#39;</span> <span class="o">|</span> <span class="s1">&#39;!=&#39;</span> <span class="o">|</span> <span class="s1">&#39;==&#39;</span> <span class="o">|</span> <span class="s1">&#39;&gt;=&#39;</span> <span class="o">|</span> <span class="s1">&#39;&gt;&#39;</span> <span class="o">|</span> <span class="s1">&#39;~=&#39;</span> <span class="o">|</span> <span class="s1">&#39;===&#39;</span>
<span class="n">version</span>       <span class="o">=</span> <span class="n">wsp</span><span class="o">*</span> <span class="p">(</span> <span class="n">letterOrDigit</span> <span class="o">|</span> <span class="s1">&#39;-&#39;</span> <span class="o">|</span> <span class="s1">&#39;_&#39;</span> <span class="o">|</span> <span class="s1">&#39;.&#39;</span> <span class="o">|</span> <span class="s1">&#39;*&#39;</span> <span class="o">|</span> <span class="s1">&#39;+&#39;</span> <span class="o">|</span> <span class="s1">&#39;!&#39;</span> <span class="p">)</span><span class="o">+</span>
<span class="n">version_one</span>   <span class="o">=</span> <span class="n">version_cmp</span> <span class="n">version</span> <span class="n">wsp</span><span class="o">*</span>
<span class="n">version_many</span>  <span class="o">=</span> <span class="n">version_one</span> <span class="p">(</span><span class="n">wsp</span><span class="o">*</span> <span class="s1">&#39;,&#39;</span> <span class="n">version_one</span><span class="p">)</span><span class="o">*</span>
<span class="n">versionspec</span>   <span class="o">=</span> <span class="p">(</span> <span class="s1">&#39;(&#39;</span> <span class="n">version_many</span> <span class="s1">&#39;)&#39;</span> <span class="p">)</span> <span class="o">|</span> <span class="n">version_many</span>
<span class="n">urlspec</span>       <span class="o">=</span> <span class="s1">&#39;@&#39;</span> <span class="n">wsp</span><span class="o">*</span> <span class="o">&lt;</span><span class="n">URI_reference</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Environment markers allow making a specification only take effect in some
environments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">marker_op</span>     <span class="o">=</span> <span class="n">version_cmp</span> <span class="o">|</span> <span class="p">(</span><span class="n">wsp</span><span class="o">*</span> <span class="s1">&#39;in&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">wsp</span><span class="o">*</span> <span class="s1">&#39;not&#39;</span> <span class="n">wsp</span><span class="o">+</span> <span class="s1">&#39;in&#39;</span><span class="p">)</span>
<span class="n">python_str_c</span>  <span class="o">=</span> <span class="p">(</span><span class="n">wsp</span> <span class="o">|</span> <span class="n">letter</span> <span class="o">|</span> <span class="n">digit</span> <span class="o">|</span> <span class="s1">&#39;(&#39;</span> <span class="o">|</span> <span class="s1">&#39;)&#39;</span> <span class="o">|</span> <span class="s1">&#39;.&#39;</span> <span class="o">|</span> <span class="s1">&#39;{&#39;</span> <span class="o">|</span> <span class="s1">&#39;}&#39;</span> <span class="o">|</span>
                 <span class="s1">&#39;-&#39;</span> <span class="o">|</span> <span class="s1">&#39;_&#39;</span> <span class="o">|</span> <span class="s1">&#39;*&#39;</span> <span class="o">|</span> <span class="s1">&#39;#&#39;</span> <span class="o">|</span> <span class="s1">&#39;:&#39;</span> <span class="o">|</span> <span class="s1">&#39;;&#39;</span> <span class="o">|</span> <span class="s1">&#39;,&#39;</span> <span class="o">|</span> <span class="s1">&#39;/&#39;</span> <span class="o">|</span> <span class="s1">&#39;?&#39;</span> <span class="o">|</span>
                 <span class="s1">&#39;[&#39;</span> <span class="o">|</span> <span class="s1">&#39;]&#39;</span> <span class="o">|</span> <span class="s1">&#39;!&#39;</span> <span class="o">|</span> <span class="s1">&#39;~&#39;</span> <span class="o">|</span> <span class="s1">&#39;`&#39;</span> <span class="o">|</span> <span class="s1">&#39;@&#39;</span> <span class="o">|</span> <span class="s1">&#39;$&#39;</span> <span class="o">|</span> <span class="s1">&#39;%&#39;</span> <span class="o">|</span> <span class="s1">&#39;^&#39;</span> <span class="o">|</span>
                 <span class="s1">&#39;&amp;&#39;</span> <span class="o">|</span> <span class="s1">&#39;=&#39;</span> <span class="o">|</span> <span class="s1">&#39;+&#39;</span> <span class="o">|</span> <span class="s1">&#39;|&#39;</span> <span class="o">|</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">|</span> <span class="s1">&#39;&gt;&#39;</span> <span class="p">)</span>
<span class="n">dquote</span>        <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span>
<span class="n">squote</span>        <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;&#39;</span>
<span class="n">python_str</span>    <span class="o">=</span> <span class="p">(</span><span class="n">squote</span> <span class="p">(</span><span class="n">python_str_c</span> <span class="o">|</span> <span class="n">dquote</span><span class="p">)</span><span class="o">*</span> <span class="n">squote</span> <span class="o">|</span>
                 <span class="n">dquote</span> <span class="p">(</span><span class="n">python_str_c</span> <span class="o">|</span> <span class="n">squote</span><span class="p">)</span><span class="o">*</span> <span class="n">dquote</span><span class="p">)</span>
<span class="n">env_var</span>       <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;python_version&#39;</span> <span class="o">|</span> <span class="s1">&#39;python_full_version&#39;</span> <span class="o">|</span>
                 <span class="s1">&#39;os_name&#39;</span> <span class="o">|</span> <span class="s1">&#39;sys_platform&#39;</span> <span class="o">|</span> <span class="s1">&#39;platform_release&#39;</span> <span class="o">|</span>
                 <span class="s1">&#39;platform_system&#39;</span> <span class="o">|</span> <span class="s1">&#39;platform_version&#39;</span> <span class="o">|</span>
                 <span class="s1">&#39;platform_machine&#39;</span> <span class="o">|</span> <span class="s1">&#39;platform_python_implementation&#39;</span> <span class="o">|</span>
                 <span class="s1">&#39;implementation_name&#39;</span> <span class="o">|</span> <span class="s1">&#39;implementation_version&#39;</span> <span class="o">|</span>
                 <span class="s1">&#39;extra&#39;</span> <span class="c1"># ONLY when defined by a containing layer</span>
                 <span class="p">)</span>
<span class="n">marker_var</span>    <span class="o">=</span> <span class="n">wsp</span><span class="o">*</span> <span class="p">(</span><span class="n">env_var</span> <span class="o">|</span> <span class="n">python_str</span><span class="p">)</span>
<span class="n">marker_expr</span>   <span class="o">=</span> <span class="n">marker_var</span> <span class="n">marker_op</span> <span class="n">marker_var</span>
              <span class="o">|</span> <span class="n">wsp</span><span class="o">*</span> <span class="s1">&#39;(&#39;</span> <span class="n">marker</span> <span class="n">wsp</span><span class="o">*</span> <span class="s1">&#39;)&#39;</span>
<span class="n">marker_and</span>    <span class="o">=</span> <span class="n">marker_expr</span> <span class="n">wsp</span><span class="o">*</span> <span class="s1">&#39;and&#39;</span> <span class="n">marker_expr</span>
              <span class="o">|</span> <span class="n">marker_expr</span>
<span class="n">marker_or</span>     <span class="o">=</span> <span class="n">marker_and</span> <span class="n">wsp</span><span class="o">*</span> <span class="s1">&#39;or&#39;</span> <span class="n">marker_and</span>
                  <span class="o">|</span> <span class="n">marker_and</span>
<span class="n">marker</span>        <span class="o">=</span> <span class="n">marker_or</span>
<span class="n">quoted_marker</span> <span class="o">=</span> <span class="s1">&#39;;&#39;</span> <span class="n">wsp</span><span class="o">*</span> <span class="n">marker</span>
</pre></div>
</div>
<p>Optional components of a distribution may be specified using the extras
field:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>identifier_end = letterOrDigit | ((&#39;-&#39; | &#39;_&#39; | &#39;.&#39; )* letterOrDigit)
identifier    = letterOrDigit identifier_end*
name          = identifier
extras_list   = identifier (wsp* &#39;,&#39; wsp* identifier)*
extras        = &#39;[&#39; wsp* extras_list? wsp* &#39;]&#39;
</pre></div>
</div>
<p>Restrictions on names for extras is defined in <span class="target" id="index-5"></span><a class="pep reference external" href="https://peps.python.org/pep-0685/"><strong>PEP 685</strong></a>.</p>
<p>Giving us a rule for name based requirements:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>name_req      = name wsp* extras? wsp* versionspec? wsp* quoted_marker?
</pre></div>
</div>
<p>And a rule for direct reference specifications:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>url_req       = name wsp* extras? wsp* urlspec wsp+ quoted_marker?
</pre></div>
</div>
<p>Leading to the unified rule that can specify a dependency.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">specification</span> <span class="o">=</span> <span class="n">wsp</span><span class="o">*</span> <span class="p">(</span> <span class="n">url_req</span> <span class="o">|</span> <span class="n">name_req</span> <span class="p">)</span> <span class="n">wsp</span><span class="o">*</span>
</pre></div>
</div>
</section>
<section id="whitespace">
<h3>Whitespace<a class="headerlink" href="#whitespace" title="永久链接至标题">¶</a></h3>
<p>Non line-breaking whitespace is mostly optional with no semantic meaning. The
sole exception is detecting the end of a URL requirement.</p>
</section>
<section id="names">
<h3>Names<a class="headerlink" href="#names" title="永久链接至标题">¶</a></h3>
<p>Python distribution names are currently defined in <span class="target" id="index-6"></span><a class="pep reference external" href="https://peps.python.org/pep-0345/"><strong>PEP 345</strong></a>. Names
act as the primary identifier for distributions. They are present in all
dependency specifications, and are sufficient to be a specification on their
own. However, PyPI places strict restrictions on names - they must match a
case insensitive regex or they won’t be accepted. Accordingly, in this
document we limit the acceptable values for identifiers to that regex. A full
redefinition of name may take place in a future metadata PEP. The regex (run
with re.IGNORECASE) is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>^([A-Z0-9]|[A-Z0-9][A-Z0-9._-]*[A-Z0-9])$
</pre></div>
</div>
</section>
<section id="extras">
<h3>Extras<a class="headerlink" href="#extras" title="永久链接至标题">¶</a></h3>
<p>An extra is an optional part of a distribution. Distributions can specify as
many extras as they wish, and each extra results in the declaration of
additional dependencies of the distribution <strong>when</strong> the extra is used in a
dependency specification. For instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">requests</span><span class="p">[</span><span class="n">security</span><span class="p">]</span>
</pre></div>
</div>
<p>Extras union in the dependencies they define with the dependencies of the
distribution they are attached to. The example above would result in requests
being installed, and requests own dependencies, and also any dependencies that
are listed in the “security” extra of requests.</p>
<p>If multiple extras are listed, all the dependencies are unioned together.</p>
</section>
<section id="versions">
<h3>Versions<a class="headerlink" href="#versions" title="永久链接至标题">¶</a></h3>
<p>See <span class="target" id="index-7"></span><a class="pep reference external" href="https://peps.python.org/pep-0440/"><strong>PEP 440</strong></a> for more detail on both version numbers and version
comparisons. Version specifications limit the versions of a distribution that
can be used. They only apply to distributions looked up by name, rather than
via a URL. Version comparison are also used in the markers feature. The
optional brackets around a version are present for compatibility with <span class="target" id="index-8"></span><a class="pep reference external" href="https://peps.python.org/pep-0345/"><strong>PEP 345</strong></a>
but should not be generated, only accepted.</p>
</section>
<section id="environment-markers">
<h3>Environment Markers<a class="headerlink" href="#environment-markers" title="永久链接至标题">¶</a></h3>
<p>Environment markers allow a dependency specification to provide a rule that
describes when the dependency should be used. For instance, consider a package
that needs argparse. In Python 2.7 argparse is always present. On older Python
versions it has to be installed as a dependency. This can be expressed as so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">argparse</span><span class="p">;</span><span class="n">python_version</span><span class="o">&lt;</span><span class="s2">&quot;2.7&quot;</span>
</pre></div>
</div>
<p>A marker expression evaluates to either True or False. When it evaluates to
False, the dependency specification should be ignored.</p>
<p>The marker language is inspired by Python itself, chosen for the ability to
safely evaluate it without running arbitrary code that could become a security
vulnerability. Markers were first standardised in <span class="target" id="index-9"></span><a class="pep reference external" href="https://peps.python.org/pep-0345/"><strong>PEP 345</strong></a>. This document
fixes some issues that were observed in the design described in <span class="target" id="index-10"></span><a class="pep reference external" href="https://peps.python.org/pep-0426/"><strong>PEP 426</strong></a>.</p>
<p>Comparisons in marker expressions are typed by the comparison operator.  The
&lt;marker_op&gt; operators that are not in &lt;version_cmp&gt; perform the same as they
do for strings in Python. The &lt;version_cmp&gt; operators use the <span class="target" id="index-11"></span><a class="pep reference external" href="https://peps.python.org/pep-0440/"><strong>PEP 440</strong></a>
version comparison rules when those are defined (that is when both
sides have a valid version specifier). If there is no defined <span class="target" id="index-12"></span><a class="pep reference external" href="https://peps.python.org/pep-0440/"><strong>PEP 440</strong></a>
behaviour and the operator exists in Python, then the operator falls back to
the Python behaviour. Otherwise an error should be raised. e.g. the following
will result in  errors:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;dog&quot;</span> <span class="o">~=</span> <span class="s2">&quot;fred&quot;</span>
<span class="n">python_version</span> <span class="o">~=</span> <span class="s2">&quot;surprise&quot;</span>
</pre></div>
</div>
<p>User supplied constants are always encoded as strings with either <code class="docutils literal notranslate"><span class="pre">'</span></code> or
<code class="docutils literal notranslate"><span class="pre">&quot;</span></code> quote marks. Note that backslash escapes are not defined, but existing
implementations do support them. They are not included in this
specification because they add complexity and there is no observable need for
them today. Similarly we do not define non-ASCII character support: all the
runtime variables we are referencing are expected to be ASCII-only.</p>
<p>The variables in the marker grammar such as “os_name” resolve to values looked
up in the Python runtime. With the exception of “extra” all values are defined
on all Python versions today - it is an error in the implementation of markers
if a value is not defined.</p>
<p>Unknown variables must raise an error rather than resulting in a comparison
that evaluates to True or False.</p>
<p>Variables whose value cannot be calculated on a given Python implementation
should evaluate to <code class="docutils literal notranslate"><span class="pre">0</span></code> for versions, and an empty string for all other
variables.</p>
<p>The “extra” variable is special. It is used by wheels to signal which
specifications apply to a given extra in the wheel <code class="docutils literal notranslate"><span class="pre">METADATA</span></code> file, but
since the <code class="docutils literal notranslate"><span class="pre">METADATA</span></code> file is based on a draft version of <span class="target" id="index-13"></span><a class="pep reference external" href="https://peps.python.org/pep-0426/"><strong>PEP 426</strong></a>, there is
no current specification for this. Regardless, outside of a context where this
special handling is taking place, the “extra” variable should result in an
error like all other unknown variables.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Marker</p></th>
<th class="head"><p>Python equivalent</p></th>
<th class="head"><p>Sample values</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">os_name</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">os.name</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">posix</span></code>, <code class="docutils literal notranslate"><span class="pre">java</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sys_platform</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sys.platform</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">linux</span></code>, <code class="docutils literal notranslate"><span class="pre">linux2</span></code>, <code class="docutils literal notranslate"><span class="pre">darwin</span></code>, <code class="docutils literal notranslate"><span class="pre">java1.8.0_51</span></code> (note that “linux”
is from Python3 and “linux2” from Python2)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">platform_machine</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">platform.machine()</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">x86_64</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">platform_python_implementation</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">platform.python_implementation()</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">CPython</span></code>, <code class="docutils literal notranslate"><span class="pre">Jython</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">platform_release</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">platform.release()</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">3.14.1-x86_64-linode39</span></code>, <code class="docutils literal notranslate"><span class="pre">14.5.0</span></code>, <code class="docutils literal notranslate"><span class="pre">1.8.0_51</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">platform_system</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">platform.system()</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Linux</span></code>, <code class="docutils literal notranslate"><span class="pre">Windows</span></code>, <code class="docutils literal notranslate"><span class="pre">Java</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">platform_version</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">platform.version()</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">#1</span> <span class="pre">SMP</span> <span class="pre">Fri</span> <span class="pre">Apr</span> <span class="pre">25</span> <span class="pre">13:07:35</span> <span class="pre">EDT</span> <span class="pre">2014</span></code>
<code class="docutils literal notranslate"><span class="pre">Java</span> <span class="pre">HotSpot(TM)</span> <span class="pre">64-Bit</span> <span class="pre">Server</span> <span class="pre">VM,</span> <span class="pre">25.51-b03,</span> <span class="pre">Oracle</span> <span class="pre">Corporation</span></code>
<code class="docutils literal notranslate"><span class="pre">Darwin</span> <span class="pre">Kernel</span> <span class="pre">Version</span> <span class="pre">14.5.0:</span> <span class="pre">Wed</span> <span class="pre">Jul</span> <span class="pre">29</span> <span class="pre">02:18:53</span> <span class="pre">PDT</span> <span class="pre">2015;</span> <span class="pre">root:xnu-2782.40.9~2/RELEASE_X86_64</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">python_version</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'.'.join(platform.python_version_tuple()[:2])</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">3.4</span></code>, <code class="docutils literal notranslate"><span class="pre">2.7</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">python_full_version</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">platform.python_version()</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">3.4.0</span></code>, <code class="docutils literal notranslate"><span class="pre">3.5.0b1</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">implementation_name</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sys.implementation.name</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">cpython</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">implementation_version</span></code></p></td>
<td><p>see definition below</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">3.4.0</span></code>, <code class="docutils literal notranslate"><span class="pre">3.5.0b1</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">extra</span></code></p></td>
<td><p>An error except when defined by the context interpreting the
specification.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">test</span></code></p></td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">implementation_version</span></code> marker variable is derived from
<code class="docutils literal notranslate"><span class="pre">sys.implementation.version</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">format_full_version</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0.major}</span><span class="s1">.</span><span class="si">{0.minor}</span><span class="s1">.</span><span class="si">{0.micro}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
    <span class="n">kind</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">releaselevel</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">!=</span> <span class="s1">&#39;final&#39;</span><span class="p">:</span>
        <span class="n">version</span> <span class="o">+=</span> <span class="n">kind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">serial</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">version</span>

<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s1">&#39;implementation&#39;</span><span class="p">):</span>
    <span class="n">implementation_version</span> <span class="o">=</span> <span class="n">format_full_version</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">implementation</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">implementation_version</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
</pre></div>
</div>
<p>This environment markers section, initially defined through <span class="target" id="index-14"></span><a class="pep reference external" href="https://peps.python.org/pep-0508/"><strong>PEP 508</strong></a>, supersedes the environment markers
section in <span class="target" id="index-15"></span><a class="pep reference external" href="https://peps.python.org/pep-0345/"><strong>PEP 345</strong></a>.</p>
</section>
</section>
<section id="complete-grammar">
<h2>Complete Grammar<a class="headerlink" href="#complete-grammar" title="永久链接至标题">¶</a></h2>
<p>The complete parsley grammar:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>wsp           = &#39; &#39; | &#39;\t&#39;
version_cmp   = wsp* &lt;&#39;&lt;=&#39; | &#39;&lt;&#39; | &#39;!=&#39; | &#39;==&#39; | &#39;&gt;=&#39; | &#39;&gt;&#39; | &#39;~=&#39; | &#39;===&#39;&gt;
version       = wsp* &lt;( letterOrDigit | &#39;-&#39; | &#39;_&#39; | &#39;.&#39; | &#39;*&#39; | &#39;+&#39; | &#39;!&#39; )+&gt;
version_one   = version_cmp:op version:v wsp* -&gt; (op, v)
version_many  = version_one:v1 (wsp* &#39;,&#39; version_one)*:v2 -&gt; [v1] + v2
versionspec   = (&#39;(&#39; version_many:v &#39;)&#39; -&gt;v) | version_many
urlspec       = &#39;@&#39; wsp* &lt;URI_reference&gt;
marker_op     = version_cmp | (wsp* &#39;in&#39;) | (wsp* &#39;not&#39; wsp+ &#39;in&#39;)
python_str_c  = (wsp | letter | digit | &#39;(&#39; | &#39;)&#39; | &#39;.&#39; | &#39;{&#39; | &#39;}&#39; |
                 &#39;-&#39; | &#39;_&#39; | &#39;*&#39; | &#39;#&#39; | &#39;:&#39; | &#39;;&#39; | &#39;,&#39; | &#39;/&#39; | &#39;?&#39; |
                 &#39;[&#39; | &#39;]&#39; | &#39;!&#39; | &#39;~&#39; | &#39;`&#39; | &#39;@&#39; | &#39;$&#39; | &#39;%&#39; | &#39;^&#39; |
                 &#39;&amp;&#39; | &#39;=&#39; | &#39;+&#39; | &#39;|&#39; | &#39;&lt;&#39; | &#39;&gt;&#39; )
dquote        = &#39;&quot;&#39;
squote        = &#39;\\&#39;&#39;
python_str    = (squote &lt;(python_str_c | dquote)*&gt;:s squote |
                 dquote &lt;(python_str_c | squote)*&gt;:s dquote) -&gt; s
env_var       = (&#39;python_version&#39; | &#39;python_full_version&#39; |
                 &#39;os_name&#39; | &#39;sys_platform&#39; | &#39;platform_release&#39; |
                 &#39;platform_system&#39; | &#39;platform_version&#39; |
                 &#39;platform_machine&#39; | &#39;platform_python_implementation&#39; |
                 &#39;implementation_name&#39; | &#39;implementation_version&#39; |
                 &#39;extra&#39; # ONLY when defined by a containing layer
                 ):varname -&gt; lookup(varname)
marker_var    = wsp* (env_var | python_str)
marker_expr   = marker_var:l marker_op:o marker_var:r -&gt; (o, l, r)
              | wsp* &#39;(&#39; marker:m wsp* &#39;)&#39; -&gt; m
marker_and    = marker_expr:l wsp* &#39;and&#39; marker_expr:r -&gt; (&#39;and&#39;, l, r)
              | marker_expr:m -&gt; m
marker_or     = marker_and:l wsp* &#39;or&#39; marker_and:r -&gt; (&#39;or&#39;, l, r)
                  | marker_and:m -&gt; m
marker        = marker_or
quoted_marker = &#39;;&#39; wsp* marker
identifier_end = letterOrDigit | ((&#39;-&#39; | &#39;_&#39; | &#39;.&#39; )* letterOrDigit)
identifier    = &lt; letterOrDigit identifier_end* &gt;
name          = identifier
extras_list   = identifier:i (wsp* &#39;,&#39; wsp* identifier)*:ids -&gt; [i] + ids
extras        = &#39;[&#39; wsp* extras_list?:e wsp* &#39;]&#39; -&gt; e
name_req      = (name:n wsp* extras?:e wsp* versionspec?:v wsp* quoted_marker?:m
                 -&gt; (n, e or [], v or [], m))
url_req       = (name:n wsp* extras?:e wsp* urlspec:v (wsp+ | end) quoted_marker?:m
                 -&gt; (n, e or [], v, m))
specification = wsp* ( url_req | name_req ):s wsp* -&gt; s
# The result is a tuple - name, list-of-extras,
# list-of-version-constraints-or-a-url, marker-ast or None


URI_reference = &lt;URI | relative_ref&gt;
URI           = scheme &#39;:&#39; hier_part (&#39;?&#39; query )? ( &#39;#&#39; fragment)?
hier_part     = (&#39;//&#39; authority path_abempty) | path_absolute | path_rootless | path_empty
absolute_URI  = scheme &#39;:&#39; hier_part ( &#39;?&#39; query )?
relative_ref  = relative_part ( &#39;?&#39; query )? ( &#39;#&#39; fragment )?
relative_part = &#39;//&#39; authority path_abempty | path_absolute | path_noscheme | path_empty
scheme        = letter ( letter | digit | &#39;+&#39; | &#39;-&#39; | &#39;.&#39;)*
authority     = ( userinfo &#39;@&#39; )? host ( &#39;:&#39; port )?
userinfo      = ( unreserved | pct_encoded | sub_delims | &#39;:&#39;)*
host          = IP_literal | IPv4address | reg_name
port          = digit*
IP_literal    = &#39;[&#39; ( IPv6address | IPvFuture) &#39;]&#39;
IPvFuture     = &#39;v&#39; hexdig+ &#39;.&#39; ( unreserved | sub_delims | &#39;:&#39;)+
IPv6address   = (
                  ( h16 &#39;:&#39;){6} ls32
                  | &#39;::&#39; ( h16 &#39;:&#39;){5} ls32
                  | ( h16 )?  &#39;::&#39; ( h16 &#39;:&#39;){4} ls32
                  | ( ( h16 &#39;:&#39;)? h16 )? &#39;::&#39; ( h16 &#39;:&#39;){3} ls32
                  | ( ( h16 &#39;:&#39;){0,2} h16 )? &#39;::&#39; ( h16 &#39;:&#39;){2} ls32
                  | ( ( h16 &#39;:&#39;){0,3} h16 )? &#39;::&#39; h16 &#39;:&#39; ls32
                  | ( ( h16 &#39;:&#39;){0,4} h16 )? &#39;::&#39; ls32
                  | ( ( h16 &#39;:&#39;){0,5} h16 )? &#39;::&#39; h16
                  | ( ( h16 &#39;:&#39;){0,6} h16 )? &#39;::&#39; )
h16           = hexdig{1,4}
ls32          = ( h16 &#39;:&#39; h16) | IPv4address
IPv4address   = dec_octet &#39;.&#39; dec_octet &#39;.&#39; dec_octet &#39;.&#39; dec_octet
nz            = ~&#39;0&#39; digit
dec_octet     = (
                  digit # 0-9
                  | nz digit # 10-99
                  | &#39;1&#39; digit{2} # 100-199
                  | &#39;2&#39; (&#39;0&#39; | &#39;1&#39; | &#39;2&#39; | &#39;3&#39; | &#39;4&#39;) digit # 200-249
                  | &#39;25&#39; (&#39;0&#39; | &#39;1&#39; | &#39;2&#39; | &#39;3&#39; | &#39;4&#39; | &#39;5&#39;) )# %250-255
reg_name = ( unreserved | pct_encoded | sub_delims)*
path = (
        path_abempty # begins with &#39;/&#39; or is empty
        | path_absolute # begins with &#39;/&#39; but not &#39;//&#39;
        | path_noscheme # begins with a non-colon segment
        | path_rootless # begins with a segment
        | path_empty ) # zero characters
path_abempty  = ( &#39;/&#39; segment)*
path_absolute = &#39;/&#39; ( segment_nz ( &#39;/&#39; segment)* )?
path_noscheme = segment_nz_nc ( &#39;/&#39; segment)*
path_rootless = segment_nz ( &#39;/&#39; segment)*
path_empty    = pchar{0}
segment       = pchar*
segment_nz    = pchar+
segment_nz_nc = ( unreserved | pct_encoded | sub_delims | &#39;@&#39;)+
                # non-zero-length segment without any colon &#39;:&#39;
pchar         = unreserved | pct_encoded | sub_delims | &#39;:&#39; | &#39;@&#39;
query         = ( pchar | &#39;/&#39; | &#39;?&#39;)*
fragment      = ( pchar | &#39;/&#39; | &#39;?&#39;)*
pct_encoded   = &#39;%&#39; hexdig
unreserved    = letter | digit | &#39;-&#39; | &#39;.&#39; | &#39;_&#39; | &#39;~&#39;
reserved      = gen_delims | sub_delims
gen_delims    = &#39;:&#39; | &#39;/&#39; | &#39;?&#39; | &#39;#&#39; | &#39;(&#39; | &#39;)?&#39; | &#39;@&#39;
sub_delims    = &#39;!&#39; | &#39;$&#39; | &#39;&amp;&#39; | &#39;\\&#39;&#39; | &#39;(&#39; | &#39;)&#39; | &#39;*&#39; | &#39;+&#39; | &#39;,&#39; | &#39;;&#39; | &#39;=&#39;
hexdig        = digit | &#39;a&#39; | &#39;A&#39; | &#39;b&#39; | &#39;B&#39; | &#39;c&#39; | &#39;C&#39; | &#39;d&#39; | &#39;D&#39; | &#39;e&#39; | &#39;E&#39; | &#39;f&#39; | &#39;F&#39;
</pre></div>
</div>
<p>A test program - if the grammar is in a string <code class="docutils literal notranslate"><span class="pre">grammar</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">platform</span>

<span class="kn">from</span> <span class="nn">parsley</span> <span class="kn">import</span> <span class="n">makeGrammar</span>

<span class="n">grammar</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    wsp ...</span>
<span class="s2">    &quot;&quot;&quot;</span>
<span class="n">tests</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;A.B-C_D&quot;</span><span class="p">,</span>
    <span class="s2">&quot;aa&quot;</span><span class="p">,</span>
    <span class="s2">&quot;name&quot;</span><span class="p">,</span>
    <span class="s2">&quot;name&lt;=1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;name&gt;=3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;name&gt;=3,&lt;2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;name@http://foo.com&quot;</span><span class="p">,</span>
    <span class="s2">&quot;name [fred,bar] @ http://foo.com ; python_version==&#39;2.7&#39;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;name[quux, strange];python_version&lt;&#39;2.7&#39; and platform_version==&#39;2&#39;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;name; os_name==&#39;a&#39; or os_name==&#39;b&#39;&quot;</span><span class="p">,</span>
    <span class="c1"># Should parse as (a and b) or c</span>
    <span class="s2">&quot;name; os_name==&#39;a&#39; and os_name==&#39;b&#39; or os_name==&#39;c&#39;&quot;</span><span class="p">,</span>
    <span class="c1"># Overriding precedence -&gt; a and (b or c)</span>
    <span class="s2">&quot;name; os_name==&#39;a&#39; and (os_name==&#39;b&#39; or os_name==&#39;c&#39;)&quot;</span><span class="p">,</span>
    <span class="c1"># should parse as a or (b and c)</span>
    <span class="s2">&quot;name; os_name==&#39;a&#39; or os_name==&#39;b&#39; and os_name==&#39;c&#39;&quot;</span><span class="p">,</span>
    <span class="c1"># Overriding precedence -&gt; (a or b) and c</span>
    <span class="s2">&quot;name; (os_name==&#39;a&#39; or os_name==&#39;b&#39;) and os_name==&#39;c&#39;&quot;</span><span class="p">,</span>
    <span class="p">]</span>

<span class="k">def</span> <span class="nf">format_full_version</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0.major}</span><span class="s1">.</span><span class="si">{0.minor}</span><span class="s1">.</span><span class="si">{0.micro}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
    <span class="n">kind</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">releaselevel</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">!=</span> <span class="s1">&#39;final&#39;</span><span class="p">:</span>
        <span class="n">version</span> <span class="o">+=</span> <span class="n">kind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">serial</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">version</span>

<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s1">&#39;implementation&#39;</span><span class="p">):</span>
    <span class="n">implementation_version</span> <span class="o">=</span> <span class="n">format_full_version</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">implementation</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
    <span class="n">implementation_name</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">implementation</span><span class="o">.</span><span class="n">name</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">implementation_version</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
    <span class="n">implementation_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">bindings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;implementation_name&#39;</span><span class="p">:</span> <span class="n">implementation_name</span><span class="p">,</span>
    <span class="s1">&#39;implementation_version&#39;</span><span class="p">:</span> <span class="n">implementation_version</span><span class="p">,</span>
    <span class="s1">&#39;os_name&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
    <span class="s1">&#39;platform_machine&#39;</span><span class="p">:</span> <span class="n">platform</span><span class="o">.</span><span class="n">machine</span><span class="p">(),</span>
    <span class="s1">&#39;platform_python_implementation&#39;</span><span class="p">:</span> <span class="n">platform</span><span class="o">.</span><span class="n">python_implementation</span><span class="p">(),</span>
    <span class="s1">&#39;platform_release&#39;</span><span class="p">:</span> <span class="n">platform</span><span class="o">.</span><span class="n">release</span><span class="p">(),</span>
    <span class="s1">&#39;platform_system&#39;</span><span class="p">:</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">(),</span>
    <span class="s1">&#39;platform_version&#39;</span><span class="p">:</span> <span class="n">platform</span><span class="o">.</span><span class="n">version</span><span class="p">(),</span>
    <span class="s1">&#39;python_full_version&#39;</span><span class="p">:</span> <span class="n">platform</span><span class="o">.</span><span class="n">python_version</span><span class="p">(),</span>
    <span class="s1">&#39;python_version&#39;</span><span class="p">:</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">python_version_tuple</span><span class="p">()[:</span><span class="mi">2</span><span class="p">]),</span>
    <span class="s1">&#39;sys_platform&#39;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">compiled</span> <span class="o">=</span> <span class="n">makeGrammar</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;lookup&#39;</span><span class="p">:</span> <span class="n">bindings</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">})</span>
<span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
    <span class="n">parsed</span> <span class="o">=</span> <span class="n">compiled</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="o">.</span><span class="n">specification</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> -&gt; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">parsed</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="summary-of-changes-to-pep-508">
<h2>Summary of changes to PEP 508<a class="headerlink" href="#summary-of-changes-to-pep-508" title="永久链接至标题">¶</a></h2>
<p>The following changes were made based on feedback after its initial
implementation:</p>
<ul class="simple">
<li><p>The definition of <code class="docutils literal notranslate"><span class="pre">python_version</span></code> was changed from
<code class="docutils literal notranslate"><span class="pre">platform.python_version()[:3]</span></code> to
<code class="docutils literal notranslate"><span class="pre">'.'.join(platform.python_version_tuple()[:2])</span></code>, to accommodate potential
future versions of Python with 2-digit major and minor versions
(e.g. 3.10). <a class="footnote-reference brackets" href="#future-versions" id="id4">3</a></p></li>
</ul>
</section>
<section id="references">
<h2>参考<a class="headerlink" href="#references" title="永久链接至标题">¶</a></h2>
<dl class="footnote brackets">
<dt class="label" id="pip"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p>pip, the recommended installer for Python packages
(<a class="reference external" href="http://pip.readthedocs.org/en/stable/">http://pip.readthedocs.org/en/stable/</a>)</p>
</dd>
<dt class="label" id="parsley"><span class="brackets"><a class="fn-backref" href="#id3">2</a></span></dt>
<dd><p>The parsley PEG library.
(<a class="reference external" href="https://pypi.python.org/pypi/parsley/">https://pypi.python.org/pypi/parsley/</a>)</p>
</dd>
<dt class="label" id="future-versions"><span class="brackets"><a class="fn-backref" href="#id4">3</a></span></dt>
<dd><p>Future Python versions might be problematic with the
definition of Environment Marker Variable <code class="docutils literal notranslate"><span class="pre">python_version</span></code>
(<a class="reference external" href="https://github.com/python/peps/issues/560">https://github.com/python/peps/issues/560</a>)</p>
</dd>
</dl>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">目录</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Python 包装的概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../flow.html">The Packaging Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/index.html">指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../discussions/index.html">讨论</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">PyPA 规范</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#package-distribution-metadata">包分发元数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#package-distribution-file-formats">包分发文件格式</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#package-index-interfaces">包索引接口</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../key_projects.html">项目摘要</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">术语表</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">如何获得支持</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute.html">为本指南做出贡献</a></li>
<li class="toctree-l1"><a class="reference internal" href="../news.html">新闻</a></li>
</ul>

  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="version-specifiers.html"
                          title="上一章">版本说明符</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="declaring-build-dependencies.html"
                          title="下一章">Declaring build system dependencies</a></p>
  </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="declaring-build-dependencies.html" title="Declaring build system dependencies"
             >下一页</a> |</li>
        <li class="right" >
          <a href="version-specifiers.html" title="版本说明符"
             >上一页</a> |</li>
          <li><img src="../_static/py.svg" alt="python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://pypa.io">PyPA</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
              <a href="../index.html">Python Packaging User Guide</a> &#187;
              
          </li>
          <li class="nav-item nav-item-1"><a href="index.html" >PyPA 规范</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Dependency specifiers</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="快速搜索" aria-label="快速搜索" type="text" name="q" />
          <input type="submit" value="转向" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
                     |
                </li>
            
      </ul>
    </div>  
    <div class="footer">
    &copy; 版权所有 2013–2020, PyPA.
    <br />
    This page is licensed under the Python Software Foundation License Version 2.
    <br />
    Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.
    <br />
    
    <br />

    The Python Software Foundation is a non-profit corporation.
<a href="https://www.python.org/psf/donations/">Please donate.</a>
<br />
    <br />

    最后更新于 2023 年 01 月 31 日.
    <a href="https://github.com/pypa/packaging.python.org/issues">Found a bug</a>?
    <br />

    由 <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0创建。
    </div>

  </body>
</html>