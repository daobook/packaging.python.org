
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>分析 PyPI 软件包的下载情况 &#8212; Python Packaging User Guide</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/pypa.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/tabs.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/translations.js"></script>
    
    <script src="../_static/sidebar.js"></script>
    
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="讨论" href="../discussions/index.html" />
    <link rel="prev" title="Tool recommendations" href="tool-recommendations.html" /><link rel="shortcut icon" type="image/png" href="../_static/py.svg" />
            <script type="text/javascript" src="../_static/copybutton.js"></script>
            <script type="text/javascript" src="../_static/menu.js"></script> 
  </head>
<body>
<div class="mobile-nav">
    <input type="checkbox" id="menuToggler" class="toggler__input" aria-controls="navigation"
           aria-pressed="false" aria-expanded="false" role="button" aria-label="Menu" />
    <label for="menuToggler" class="toggler__label">
        <span></span>
    </label>
    <nav class="nav-content" role="navigation">
         <a href="https://pypa.io" class="nav-logo">
             <img src="../_static/py.svg" alt="Logo"/>
         </a>
        <div class="version_switcher_placeholder"></div>
        <form role="search" class="search" action="../search.html" method="get">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="search-icon">
                <path fill-rule="nonzero"
                        d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 001.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 00-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 005.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" fill="#444"></path>
            </svg>
            <input type="text" name="q" aria-label="快速搜索"/>
            <input type="submit" value="转向"/>
        </form>
    </nav>
    <div class="menu-wrapper">
        <nav class="menu" role="navigation" aria-label="main navigation">
            <div class="language_switcher_placeholder"></div>
<h3><a href="../index.html">目录</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Python 包装的概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../flow.html">The Packaging Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">教程</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">指南</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installing-using-pip-and-virtual-environments.html">Installing packages using pip and virtual environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="installing-stand-alone-command-line-tools.html">安装独立命令行工具</a></li>
<li class="toctree-l2"><a class="reference internal" href="installing-using-linux-tools.html">用 Linux 软件包管理器安装 pip/setuptools/wheel</a></li>
<li class="toctree-l2"><a class="reference internal" href="installing-scientific-packages.html">Installing scientific packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-mirrors-and-caches.html">Package index mirrors and caches</a></li>
<li class="toctree-l2"><a class="reference internal" href="hosting-your-own-index.html">Hosting your own simple repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="distributing-packages-using-setuptools.html">Packaging and distributing projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="using-manifest-in.html">Including files in source distributions with <code class="docutils literal notranslate"><span class="pre">MANIFEST.in</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="single-sourcing-package-version.html">Single-sourcing the package version</a></li>
<li class="toctree-l2"><a class="reference internal" href="dropping-older-python-versions.html">放弃对旧版 Python 的支持</a></li>
<li class="toctree-l2"><a class="reference internal" href="packaging-binary-extensions.html">Packaging binary extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="packaging-namespace-packages.html">Packaging namespace packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="creating-and-discovering-plugins.html">创建和发现插件</a></li>
<li class="toctree-l2"><a class="reference internal" href="using-testpypi.html">使用 TestPyPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="making-a-pypi-friendly-readme.html">Making a PyPI-friendly README</a></li>
<li class="toctree-l2"><a class="reference internal" href="publishing-package-distribution-releases-using-github-actions-ci-cd-workflows.html">Publishing package distribution releases using GitHub Actions CI/CD workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="tool-recommendations.html">Tool recommendations</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">分析 PyPI 软件包的下载情况</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../discussions/index.html">讨论</a></li>
<li class="toctree-l1"><a class="reference internal" href="../specifications/index.html">PyPA 规范</a></li>
<li class="toctree-l1"><a class="reference internal" href="../key_projects.html">项目摘要</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">术语表</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">如何获得支持</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute.html">为本指南做出贡献</a></li>
<li class="toctree-l1"><a class="reference internal" href="../news.html">新闻</a></li>
</ul>

  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="tool-recommendations.html"
                          title="上一章">Tool recommendations</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="../discussions/index.html"
                          title="下一章">讨论</a></p>
  </div>
        </nav>
    </div>
</div>
  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../discussions/index.html" title="讨论"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="tool-recommendations.html" title="Tool recommendations"
             accesskey="P">上一页</a> |</li>
          <li><img src="../_static/py.svg" alt="python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://pypa.io">PyPA</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
              <a href="../index.html">Python Packaging User Guide</a> &#187;
              
          </li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">指南</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">分析 PyPI 软件包的下载情况</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="快速搜索" aria-label="快速搜索" type="text" name="q" />
          <input type="submit" value="转向" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
                     |
                </li>
            
      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="analyzing-pypi-package-downloads">
<h1>分析 PyPI 软件包的下载情况<a class="headerlink" href="#analyzing-pypi-package-downloads" title="永久链接至标题">¶</a></h1>
<p>本节介绍了如何使用公共的 PyPI 下载统计数据集来了解PyPI上托管的软件包 (packages) 的下载情况。例如，您可以用它来发现用于下载软件包的 Python 版本的分布。</p>
<div class="contents local topic" id="contents">
<p class="topic-title">导航</p>
<ul class="simple">
<li><p><a class="reference internal" href="#background" id="id8">背景</a></p></li>
<li><p><a class="reference internal" href="#public-dataset" id="id9">公共数据集</a></p>
<ul>
<li><p><a class="reference internal" href="#getting-set-up" id="id10">开始设置</a></p></li>
<li><p><a class="reference internal" href="#data-schema" id="id11">Data schema</a></p></li>
<li><p><a class="reference internal" href="#useful-queries" id="id12">有用的查询</a></p>
<ul>
<li><p><a class="reference internal" href="#counting-package-downloads" id="id13">-计算软件包的下载量</a></p></li>
<li><p><a class="reference internal" href="#package-downloads-over-time" id="id14">Package downloads over time</a></p></li>
<li><p><a class="reference internal" href="#python-versions-over-time" id="id15">Python versions over time</a></p></li>
<li><p><a class="reference internal" href="#getting-absolute-links-to-artifacts" id="id16">Getting absolute links to artifacts</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#caveats" id="id17">注意事项</a></p></li>
<li><p><a class="reference internal" href="#additional-tools" id="id18">附加工具</a></p>
<ul>
<li><p><a class="reference internal" href="#google-cloud-bigquery" id="id19"><code class="docutils literal notranslate"><span class="pre">google-cloud-bigquery</span></code></a></p></li>
<li><p><a class="reference internal" href="#pypinfo" id="id20"><code class="docutils literal notranslate"><span class="pre">pypinfo</span></code></a></p></li>
<li><p><a class="reference internal" href="#pandas-gbq" id="id21"><code class="docutils literal notranslate"><span class="pre">pandas-gbq</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#references" id="id22">参考</a></p></li>
</ul>
</div>
<section id="background">
<h2><a class="toc-backref" href="#id8">背景</a><a class="headerlink" href="#background" title="永久链接至标题">¶</a></h2>
<p>由于一些原因，PyPI 不显示下载统计数据。<a class="footnote-reference brackets" href="#id3" id="id1">1</a></p>
<ul class="simple">
<li><p><strong>Inefficient to make work with a Content Distribution Network (CDN):</strong>
Download statistics change constantly. Including them in project pages, which
are heavily cached, would require invalidating the cache more often, and
reduce the overall effectiveness of the cache.</p></li>
<li><p><strong>Highly inaccurate:</strong> A number of things prevent the download counts from
being accurate, some of which include:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">pip</span></code> 的下载缓存（降低下载次数）</p></li>
<li><p>内部或非官方的镜像（既可以提高也可以降低下载量）</p></li>
<li><p>未在 PyPI 上托管的软件包（为了比较）</p></li>
<li><p>Unofficial scripts or attempts at download count inflation (raises download
counts)</p></li>
<li><p>Known historical data quality issues (lowers download counts)</p></li>
</ul>
</li>
<li><p><strong>Not particularly useful:</strong> Just because a project has been downloaded a lot
doesn’t mean it’s good; Similarly just because a project hasn’t been
downloaded a lot doesn’t mean it’s bad!</p></li>
</ul>
<p>In short, because it’s value is low for various reasons, and the tradeoffs
required to make it work are high, it has been not an effective use of
limited resources.</p>
</section>
<section id="public-dataset">
<h2><a class="toc-backref" href="#id9">公共数据集</a><a class="headerlink" href="#public-dataset" title="永久链接至标题">¶</a></h2>
<p>As an alternative, the <a class="reference external" href="https://github.com/pypa/linehaul-cloud-function/">Linehaul project</a>
streams download logs from PyPI to <a class="reference external" href="https://cloud.google.com/bigquery">Google BigQuery</a> <a class="footnote-reference brackets" href="#id4" id="id2">2</a>, where they are
stored as a public dataset.</p>
<section id="getting-set-up">
<h3><a class="toc-backref" href="#id10">开始设置</a><a class="headerlink" href="#getting-set-up" title="永久链接至标题">¶</a></h3>
<p>In order to use <a class="reference external" href="https://cloud.google.com/bigquery">Google BigQuery</a> to query the <a class="reference external" href="https://console.cloud.google.com/bigquery?p=bigquery-public-data&amp;d=pypi&amp;page=dataset">public PyPI download
statistics dataset</a>, you’ll need a Google account and to enable the BigQuery
API on a Google Cloud Platform project. You can run up to 1TB of queries
per month <a class="reference external" href="https://cloud.google.com/blog/products/data-analytics/query-without-a-credit-card-introducing-bigquery-sandbox">using the BigQuery free tier without a credit card</a></p>
<ul class="simple">
<li><p>导航到 <a class="reference external" href="https://console.cloud.google.com/bigquery">BigQuery web UI</a>。</p></li>
<li><p>创建一个新的项目。</p></li>
<li><p>启用`BigQuery API &lt;<a class="reference external" href="https://console.developers.google.com/apis/library/bigquery-json.googleapis.com">https://console.developers.google.com/apis/library/bigquery-json.googleapis.com</a>&gt;`__。</p></li>
</ul>
<p>关于如何开始使用 BigQuery 的更多详细说明，请查看`BigQuery 快速入门指南 &lt;<a class="reference external" href="https://cloud.google.com/bigquery/docs/quickstarts/quickstart-web-ui">https://cloud.google.com/bigquery/docs/quickstarts/quickstart-web-ui</a>&gt;`__ 。</p>
</section>
<section id="data-schema">
<h3><a class="toc-backref" href="#id11">Data schema</a><a class="headerlink" href="#data-schema" title="永久链接至标题">¶</a></h3>
<p>Linehaul writes an entry in a <code class="docutils literal notranslate"><span class="pre">bigquery-public-data.pypi.file_downloads</span></code> table for each
download. The table contains information about what file was downloaded and how
it was downloaded. Some useful columns from the <a class="reference external" href="https://console.cloud.google.com/bigquery?pli=1&amp;p=bigquery-public-data&amp;d=pypi&amp;t=file_downloads&amp;page=table">table schema</a>
include:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 34%" />
<col style="width: 24%" />
<col style="width: 41%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>列</p></th>
<th class="head"><p>描述</p></th>
<th class="head"><p>例子</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>时间戳 (timestamp)</p></td>
<td><p>日期和时间 (Date and time)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">2020-03-09</span> <span class="pre">00:33:03</span> <span class="pre">UTC</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>file.project</p></td>
<td><p>项目名称</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pipenv</span></code>, <code class="docutils literal notranslate"><span class="pre">nose</span></code></p></td>
</tr>
<tr class="row-even"><td><p>file.version</p></td>
<td><p>包版本</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0.1.6</span></code>, <code class="docutils literal notranslate"><span class="pre">1.4.2</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>details.installer.name</p></td>
<td><p>安装程序</p></td>
<td><p>pip, <a class="reference internal" href="../key_projects.html#bandersnatch"><span class="std std-ref">bandersnatch</span></a></p></td>
</tr>
<tr class="row-even"><td><p>details.python</p></td>
<td><p>Python 版本</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">2.7.12</span></code>, <code class="docutils literal notranslate"><span class="pre">3.6.4</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="useful-queries">
<h3><a class="toc-backref" href="#id12">有用的查询</a><a class="headerlink" href="#useful-queries" title="永久链接至标题">¶</a></h3>
<p>Run queries in the <a class="reference external" href="https://console.cloud.google.com/bigquery">BigQuery web UI</a> by clicking the “Compose query” button.</p>
<p>Note that the rows are stored in a partitioned, which helps
limit the cost of queries. These example queries analyze downloads from
recent history by filtering on the <code class="docutils literal notranslate"><span class="pre">timestamp</span></code> column.</p>
<section id="counting-package-downloads">
<h4><a class="toc-backref" href="#id13">-计算软件包的下载量</a><a class="headerlink" href="#counting-package-downloads" title="永久链接至标题">¶</a></h4>
<p>下面的查询统计了 “pytest ” 项目的总下载次数。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#standardSQL
SELECT COUNT(*) AS num_downloads
FROM `bigquery-public-data.pypi.file_downloads`
WHERE file.project = &#39;pytest&#39;
  -- Only query the last 30 days of history
  AND DATE(timestamp)
    BETWEEN DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)
    AND CURRENT_DATE()
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>num_downloads</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>26190085</p></td>
</tr>
</tbody>
</table>
<p>要想只计算来自 pip 的下载量，可以在 <code class="docutils literal notranslate"><span class="pre">details.installer.name</span></code> 列上过滤。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#standardSQL
SELECT COUNT(*) AS num_downloads
FROM `bigquery-public-data.pypi.file_downloads`
WHERE file.project = &#39;pytest&#39;
  AND details.installer.name = &#39;pip&#39;
  -- Only query the last 30 days of history
  AND DATE(timestamp)
    BETWEEN DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)
    AND CURRENT_DATE()
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>num_downloads</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>24334215</p></td>
</tr>
</tbody>
</table>
</section>
<section id="package-downloads-over-time">
<h4><a class="toc-backref" href="#id14">Package downloads over time</a><a class="headerlink" href="#package-downloads-over-time" title="永久链接至标题">¶</a></h4>
<p>要按月下载量分组，请使用 <code class="docutils literal notranslate"><span class="pre">TIMESTAMP_TRUNC</span></code> 函数。同时按这一栏过滤可以减少相应的费用。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#standardSQL
SELECT
  COUNT(*) AS num_downloads,
  DATE_TRUNC(DATE(timestamp), MONTH) AS `month`
FROM `bigquery-public-data.pypi.file_downloads`
WHERE
  file.project = &#39;pytest&#39;
  -- Only query the last 6 months of history
  AND DATE(timestamp)
    BETWEEN DATE_TRUNC(DATE_SUB(CURRENT_DATE(), INTERVAL 6 MONTH), MONTH)
    AND CURRENT_DATE()
GROUP BY `month`
ORDER BY `month` DESC
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 56%" />
<col style="width: 44%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>num_downloads</p></th>
<th class="head"><p>month</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1956741</p></td>
<td><p>2018-01-01</p></td>
</tr>
<tr class="row-odd"><td><p>2344692</p></td>
<td><p>2017-12-01</p></td>
</tr>
<tr class="row-even"><td><p>1730398</p></td>
<td><p>2017-11-01</p></td>
</tr>
<tr class="row-odd"><td><p>2047310</p></td>
<td><p>2017-10-01</p></td>
</tr>
<tr class="row-even"><td><p>1744443</p></td>
<td><p>2017-09-01</p></td>
</tr>
<tr class="row-odd"><td><p>1916952</p></td>
<td><p>2017-08-01</p></td>
</tr>
</tbody>
</table>
</section>
<section id="python-versions-over-time">
<h4><a class="toc-backref" href="#id15">Python versions over time</a><a class="headerlink" href="#python-versions-over-time" title="永久链接至标题">¶</a></h4>
<p>从 <code class="docutils literal notranslate"><span class="pre">details.python</span></code> 列中提取 Python 版本。警告：这个查询处理超过 500GB 的数据。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#standardSQL
SELECT
  REGEXP_EXTRACT(details.python, r&quot;[0-9]+\.[0-9]+&quot;) AS python_version,
  COUNT(*) AS num_downloads,
FROM `bigquery-public-data.pypi.file_downloads`
WHERE
  -- Only query the last 6 months of history
  DATE(timestamp)
    BETWEEN DATE_TRUNC(DATE_SUB(CURRENT_DATE(), INTERVAL 6 MONTH), MONTH)
    AND CURRENT_DATE()
GROUP BY `python_version`
ORDER BY `num_downloads` DESC
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 35%" />
<col style="width: 65%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>python</p></th>
<th class="head"><p>num_downloads</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>3.7</p></td>
<td><p>18051328726</p></td>
</tr>
<tr class="row-odd"><td><p>3.6</p></td>
<td><p>9635067203</p></td>
</tr>
<tr class="row-even"><td><p>3.8</p></td>
<td><p>7781904681</p></td>
</tr>
<tr class="row-odd"><td><p>2.7</p></td>
<td><p>6381252241</p></td>
</tr>
<tr class="row-even"><td><p>空</p></td>
<td><p>2026630299</p></td>
</tr>
<tr class="row-odd"><td><p>3.5</p></td>
<td><p>1894153540</p></td>
</tr>
</tbody>
</table>
</section>
<section id="getting-absolute-links-to-artifacts">
<h4><a class="toc-backref" href="#id16">Getting absolute links to artifacts</a><a class="headerlink" href="#getting-absolute-links-to-artifacts" title="永久链接至标题">¶</a></h4>
<p>It’s sometimes helpful to be able to get the absolute links to download
artifacts from PyPI based on their hashes, e.g. if a particular project or
release has been deleted from PyPI. The metadata table includes the <code class="docutils literal notranslate"><span class="pre">path</span></code>
column, which includes the hash and artifact filename.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>The URL generated here is not guaranteed to be stable, but currently aligns with the URL where PyPI artifacts are hosted.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT
  CONCAT(&#39;https://files.pythonhosted.org/packages&#39;, path) as url
FROM
  `bigquery-public-data.pypi.distribution_metadata`
WHERE
  filename LIKE &#39;sampleproject%&#39;
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>url</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference external" href="https://files.pythonhosted.org/packages/eb/45/79be82bdeafcecb9dca474cad4003e32ef8e4a0dec6abbd4145ccb02abe1/sampleproject-1.2.0.tar.gz">https://files.pythonhosted.org/packages/eb/45/79be82bdeafcecb9dca474cad4003e32ef8e4a0dec6abbd4145ccb02abe1/sampleproject-1.2.0.tar.gz</a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://files.pythonhosted.org/packages/56/0a/178e8bbb585ec5b13af42dae48b1d7425d6575b3ff9b02e5ec475e38e1d6/sampleproject_nomura-1.2.0-py2.py3-none-any.whl">https://files.pythonhosted.org/packages/56/0a/178e8bbb585ec5b13af42dae48b1d7425d6575b3ff9b02e5ec475e38e1d6/sampleproject_nomura-1.2.0-py2.py3-none-any.whl</a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://files.pythonhosted.org/packages/63/88/3200eeaf22571f18d2c41e288862502e33365ccbdc12b892db23f51f8e70/sampleproject_nomura-1.2.0.tar.gz">https://files.pythonhosted.org/packages/63/88/3200eeaf22571f18d2c41e288862502e33365ccbdc12b892db23f51f8e70/sampleproject_nomura-1.2.0.tar.gz</a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://files.pythonhosted.org/packages/21/e9/2743311822e71c0756394b6c5ab15cb64ca66c78c6c6a5cd872c9ed33154/sampleproject_doubleyoung18-1.3.0-py2.py3-none-any.whl">https://files.pythonhosted.org/packages/21/e9/2743311822e71c0756394b6c5ab15cb64ca66c78c6c6a5cd872c9ed33154/sampleproject_doubleyoung18-1.3.0-py2.py3-none-any.whl</a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://files.pythonhosted.org/packages/6f/5b/2f3fe94e1c02816fe23c7ceee5292fb186912929e1972eee7fb729fa27af/sampleproject-1.3.1.tar.gz">https://files.pythonhosted.org/packages/6f/5b/2f3fe94e1c02816fe23c7ceee5292fb186912929e1972eee7fb729fa27af/sampleproject-1.3.1.tar.gz</a></p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="caveats">
<h2><a class="toc-backref" href="#id17">注意事项</a><a class="headerlink" href="#caveats" title="永久链接至标题">¶</a></h2>
<p>In addition to the caveats listed in the background above, Linehaul suffered
from a bug which caused it to significantly under-report download statistics
prior to July 26, 2018. Downloads before this date are proportionally accurate
(e.g. the percentage of Python 2 vs. Python 3 downloads) but total numbers are
lower than actual by an order of magnitude.</p>
</section>
<section id="additional-tools">
<h2><a class="toc-backref" href="#id18">附加工具</a><a class="headerlink" href="#additional-tools" title="永久链接至标题">¶</a></h2>
<p>除了使用 BigQuery 控制台，还有一些额外的工具，在分析下载统计数据时可能很有用。</p>
<section id="google-cloud-bigquery">
<h3><a class="toc-backref" href="#id19"><code class="docutils literal notranslate"><span class="pre">google-cloud-bigquery</span></code></a><a class="headerlink" href="#google-cloud-bigquery" title="永久链接至标题">¶</a></h3>
<p>您也可以通过 BigQuery API 和 BigQuery 的官方 Python 客户端库 <a class="reference external" href="https://cloud.google.com/bigquery/docs/reference/libraries">google-cloud-bigquery</a> 项目，以编程方式访问公共 PyPI 下载统计数据集。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">google.cloud</span> <span class="kn">import</span> <span class="n">bigquery</span>

<span class="c1"># Note: depending on where this code is being run, you may require</span>
<span class="c1"># additional authentication. See:</span>
<span class="c1"># https://cloud.google.com/bigquery/docs/authentication/</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">bigquery</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>

<span class="n">query_job</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT COUNT(*) AS num_downloads</span>
<span class="s2">FROM `bigquery-public-data.pypi.file_downloads`</span>
<span class="s2">WHERE file.project = &#39;pytest&#39;</span>
<span class="s2">  -- Only query the last 30 days of history</span>
<span class="s2">  AND DATE(timestamp)</span>
<span class="s2">    BETWEEN DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)</span>
<span class="s2">    AND CURRENT_DATE()&quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">query_job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>  <span class="c1"># Waits for job to complete.</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> downloads&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">num_downloads</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="pypinfo">
<h3><a class="toc-backref" href="#id20"><code class="docutils literal notranslate"><span class="pre">pypinfo</span></code></a><a class="headerlink" href="#pypinfo" title="永久链接至标题">¶</a></h3>
<p><a class="reference external" href="https://github.com/ofek/pypinfo/blob/master/README.rst">pypinfo</a> 是一个命令行工具，它提供对数据集的访问，并可以生成一些有用的查询。例如，你可以用 <code class="docutils literal notranslate"><span class="pre">pypinfo</span> <span class="pre">package_name</span></code> 命令来查询某个软件包的总下载次数。</p>
<p>使用 pip 安装 <a class="reference external" href="https://github.com/ofek/pypinfo/blob/master/README.rst">pypinfo</a> 。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>pypinfo
</pre></div>
</div>
<p>使用方法：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pypinfo<span class="w"> </span>requests
<span class="go">Served from cache: False</span>
<span class="go">Data processed: 6.87 GiB</span>
<span class="go">Data billed: 6.87 GiB</span>
<span class="go">Estimated cost: $0.04</span>

<span class="go">| download_count |</span>
<span class="go">| -------------- |</span>
<span class="go">|      9,316,415 |</span>
</pre></div>
</div>
</section>
<section id="pandas-gbq">
<h3><a class="toc-backref" href="#id21"><code class="docutils literal notranslate"><span class="pre">pandas-gbq</span></code></a><a class="headerlink" href="#pandas-gbq" title="永久链接至标题">¶</a></h3>
<p><a class="reference external" href="https://pandas-gbq.readthedocs.io/en/latest/">pandas-gbq</a> 项目允许通过 <a class="reference external" href="https://pandas.pydata.org/">Pandas</a> 来访问查询结果。</p>
</section>
</section>
<section id="references">
<h2><a class="toc-backref" href="#id22">参考</a><a class="headerlink" href="#references" title="永久链接至标题">¶</a></h2>
<dl class="footnote brackets">
<dt class="label" id="id3"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p><a class="reference external" href="https://mail.python.org/pipermail/distutils-sig/2013-May/020855.html">PyPI 下载计数的废弃电子邮件</a></p>
</dd>
<dt class="label" id="id4"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p><a class="reference external" href="https://mail.python.org/pipermail/distutils-sig/2016-May/028986.html">PyPI BigQuery 数据集公告邮件</a></p>
</dd>
</dl>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">目录</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Python 包装的概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../flow.html">The Packaging Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">教程</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">指南</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installing-using-pip-and-virtual-environments.html">Installing packages using pip and virtual environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="installing-stand-alone-command-line-tools.html">安装独立命令行工具</a></li>
<li class="toctree-l2"><a class="reference internal" href="installing-using-linux-tools.html">用 Linux 软件包管理器安装 pip/setuptools/wheel</a></li>
<li class="toctree-l2"><a class="reference internal" href="installing-scientific-packages.html">Installing scientific packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-mirrors-and-caches.html">Package index mirrors and caches</a></li>
<li class="toctree-l2"><a class="reference internal" href="hosting-your-own-index.html">Hosting your own simple repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="distributing-packages-using-setuptools.html">Packaging and distributing projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="using-manifest-in.html">Including files in source distributions with <code class="docutils literal notranslate"><span class="pre">MANIFEST.in</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="single-sourcing-package-version.html">Single-sourcing the package version</a></li>
<li class="toctree-l2"><a class="reference internal" href="dropping-older-python-versions.html">放弃对旧版 Python 的支持</a></li>
<li class="toctree-l2"><a class="reference internal" href="packaging-binary-extensions.html">Packaging binary extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="packaging-namespace-packages.html">Packaging namespace packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="creating-and-discovering-plugins.html">创建和发现插件</a></li>
<li class="toctree-l2"><a class="reference internal" href="using-testpypi.html">使用 TestPyPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="making-a-pypi-friendly-readme.html">Making a PyPI-friendly README</a></li>
<li class="toctree-l2"><a class="reference internal" href="publishing-package-distribution-releases-using-github-actions-ci-cd-workflows.html">Publishing package distribution releases using GitHub Actions CI/CD workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="tool-recommendations.html">Tool recommendations</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">分析 PyPI 软件包的下载情况</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../discussions/index.html">讨论</a></li>
<li class="toctree-l1"><a class="reference internal" href="../specifications/index.html">PyPA 规范</a></li>
<li class="toctree-l1"><a class="reference internal" href="../key_projects.html">项目摘要</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">术语表</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">如何获得支持</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute.html">为本指南做出贡献</a></li>
<li class="toctree-l1"><a class="reference internal" href="../news.html">新闻</a></li>
</ul>

  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="tool-recommendations.html"
                          title="上一章">Tool recommendations</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="../discussions/index.html"
                          title="下一章">讨论</a></p>
  </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="../discussions/index.html" title="讨论"
             >下一页</a> |</li>
        <li class="right" >
          <a href="tool-recommendations.html" title="Tool recommendations"
             >上一页</a> |</li>
          <li><img src="../_static/py.svg" alt="python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://pypa.io">PyPA</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
              <a href="../index.html">Python Packaging User Guide</a> &#187;
              
          </li>
          <li class="nav-item nav-item-1"><a href="index.html" >指南</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">分析 PyPI 软件包的下载情况</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="快速搜索" aria-label="快速搜索" type="text" name="q" />
          <input type="submit" value="转向" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
                     |
                </li>
            
      </ul>
    </div>  
    <div class="footer">
    &copy; 版权所有 2013–2020, PyPA.
    <br />
    This page is licensed under the Python Software Foundation License Version 2.
    <br />
    Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.
    <br />
    
    <br />

    The Python Software Foundation is a non-profit corporation.
<a href="https://www.python.org/psf/donations/">Please donate.</a>
<br />
    <br />

    最后更新于 2023 年 01 月 31 日.
    <a href="https://github.com/pypa/packaging.python.org/issues">Found a bug</a>?
    <br />

    由 <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0创建。
    </div>

  </body>
</html>